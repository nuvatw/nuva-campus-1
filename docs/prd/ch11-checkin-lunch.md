# Chapter 11: æ´»å‹•å ±åˆ°èˆ‡ä¾¿ç•¶ç³»çµ±

[â† è¿”å›ç´¢å¼•](./README.md) | [ä¸Šä¸€ç« ](./ch10-guardian-zone.md) | [ä¸‹ä¸€ç«  â†’](./ch12-code-generator.md)

---

## 11.1 å ±åˆ°ç³»çµ±

### å ±åˆ°æµç¨‹

```
å·¥ä½œäººå“¡é–‹å•Ÿå ±åˆ°é é¢
    â†“
åƒèˆ‡è€…å‘ŠçŸ¥å››ä½æ•¸å ±åˆ°ç·¨è™Ÿ
    â†“
å·¥ä½œäººå“¡è¼¸å…¥ç·¨è™Ÿ
    â†“
ç³»çµ±é¡¯ç¤ºåƒèˆ‡è€…è³‡è¨Šï¼ˆå§“åã€ä¿¡ç®±ï¼‰
    â†“
å·¥ä½œäººå“¡ç¢ºèªèº«ä»½
    â†“
é»æ“Šã€Œç¢ºèªå ±åˆ°ã€
    â†“
é¡¯ç¤ºæˆåŠŸè¨Šæ¯
    â†“
è‡ªå‹•è¿”å›è¼¸å…¥é é¢
```

### å ±åˆ°ä»‹é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â† è¿”å›]                              [ğŸ”å§“å] [ğŸ“§ä¿¡ç®±]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                       åƒèˆ‡è€…å ±åˆ°                             â”‚
â”‚                                                             â”‚
â”‚               â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                      â”‚
â”‚               â”‚ _ â”‚ â”‚ _ â”‚ â”‚ _ â”‚ â”‚ _ â”‚                      â”‚
â”‚               â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                      â”‚
â”‚                                                             â”‚
â”‚                   è«‹è¼¸å…¥å ±åˆ°ç·¨è™Ÿ                             â”‚
â”‚                                                             â”‚
â”‚              â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                             â”‚
â”‚              â”‚ 1 â”‚ â”‚ 2 â”‚ â”‚ 3 â”‚                             â”‚
â”‚              â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                             â”‚
â”‚              â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                             â”‚
â”‚              â”‚ 4 â”‚ â”‚ 5 â”‚ â”‚ 6 â”‚                             â”‚
â”‚              â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                             â”‚
â”‚              â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                             â”‚
â”‚              â”‚ 7 â”‚ â”‚ 8 â”‚ â”‚ 9 â”‚                             â”‚
â”‚              â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                             â”‚
â”‚              â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”                             â”‚
â”‚              â”‚   â”‚ â”‚ 0 â”‚ â”‚ âŒ« â”‚                             â”‚
â”‚              â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜                             â”‚
â”‚                                                             â”‚
â”‚                   å·²å ±åˆ°: 25 / 45                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¢ºèªä»‹é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚                     ç¢ºèªåƒèˆ‡è€…è³‡è¨Š                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  å ±åˆ°ç·¨è™Ÿ    1234                                   â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  å§“å       ç‹å°æ˜                                  â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  ä¿¡ç®±       xiaoming@example.com                    â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚         [  å–æ¶ˆ  ]              [  ç¢ºèªå ±åˆ°  ]              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŸ¥è©¢åŠŸèƒ½ Popup

å³ä¸Šè§’æœ‰å…©å€‹ icon æŒ‰éˆ•ï¼šğŸ” å§“åæŸ¥è©¢ã€ğŸ“§ ä¿¡ç®±æŸ¥è©¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è©¢åƒèˆ‡è€…                                          [âœ•]    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚                                                             â”‚
â”‚  [________________________________]  [æœå°‹]                 â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç‹å°æ˜                                              â”‚   â”‚
â”‚  â”‚ xiaoming@example.com                    [  å ±åˆ°  ]  â”‚   â”‚
â”‚  â”‚ ç·¨è™Ÿ: 1234                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç‹å¤§æ˜                                              â”‚   â”‚
â”‚  â”‚ daming@example.com                      [å·²å ±åˆ°]    â”‚   â”‚
â”‚  â”‚ ç·¨è™Ÿ: 5678                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æˆåŠŸç•«é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚                          âœ“                                  â”‚
â”‚                                                             â”‚
â”‚                     å ±åˆ°æˆåŠŸ                                 â”‚
â”‚                                                             â”‚
â”‚                      ç‹å°æ˜                                 â”‚
â”‚                                                             â”‚
â”‚                   [  è¿”å›  ]                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11.2 ä¾¿ç•¶é ˜å–ç³»çµ±

èˆ‡å ±åˆ°ç³»çµ±é¡ä¼¼ï¼Œä½†ï¼š
- æ¨™é¡Œæ”¹ç‚ºã€Œä¾¿ç•¶é ˜å–ã€
- è¼¸å…¥ä¾¿ç•¶ç·¨è™Ÿ
- lunch_code ç‚º `0000` æ™‚é¡¯ç¤ºã€Œæ²’æœ‰ä¾¿ç•¶ã€

### ç‰¹æ®Šæƒ…æ³è™•ç†

| æƒ…æ³ | è™•ç†æ–¹å¼ |
|------|----------|
| `lunch_code = 0000` | é¡¯ç¤ºã€Œæ­¤åƒèˆ‡è€…æ²’æœ‰ä¾¿ç•¶ã€ |
| ç·¨è™Ÿä¸å­˜åœ¨ | é¡¯ç¤ºã€ŒæŸ¥ç„¡æ­¤ç·¨è™Ÿã€ |
| å·²é ˜å– | é¡¯ç¤ºã€Œæ­¤ä¾¿ç•¶å·²é ˜å–ã€ |

---

## 11.3 Supabase æŸ¥è©¢

### å ±åˆ°æŸ¥è©¢

```typescript
// æ ¹æ“šå ±åˆ°ç·¨è™ŸæŸ¥è©¢
const { data } = await supabase
  .from('event_registrations')
  .select('*')
  .eq('event_id', eventId)
  .eq('checkin_code', code)
  .single();
```

### ä¾¿ç•¶æŸ¥è©¢

```typescript
// æ ¹æ“šä¾¿ç•¶ç·¨è™ŸæŸ¥è©¢
const { data } = await supabase
  .from('event_registrations')
  .select('*')
  .eq('event_id', eventId)
  .eq('lunch_code', code)
  .single();
```

### æ›´æ–°å ±åˆ°ç‹€æ…‹

```typescript
await supabase
  .from('event_registrations')
  .update({ attended: true })
  .eq('id', registrationId);
```

---

## 11.4 Chain of Thought - å¯¦æ–½æ­¥é©Ÿ

```
1. å»ºç«‹å…±ç”¨çµ„ä»¶
   - NumericKeypad.tsxï¼ˆæ•¸å­—éµç›¤ï¼‰
   - CodeInput.tsxï¼ˆå››ä½æ•¸è¼¸å…¥æ¡†ï¼‰
   - ParticipantCard.tsxï¼ˆåƒèˆ‡è€…è³‡è¨Šå¡ï¼‰
   - SearchPopup.tsxï¼ˆæŸ¥è©¢å½ˆçª—ï¼‰
   - SuccessScreen.tsxï¼ˆæˆåŠŸç•«é¢ï¼‰

2. å»ºç«‹å ±åˆ°é é¢
   - /app/guardian/events/[id]/checkin/page.tsx
   - é€£æ¥ Supabase æŸ¥è©¢
   - æ›´æ–°å ±åˆ°ç‹€æ…‹

3. å»ºç«‹ä¾¿ç•¶é é¢
   - /app/guardian/events/[id]/lunch/page.tsx
   - è¤‡ç”¨å ±åˆ°çµ„ä»¶
   - è™•ç† 0000 é‚è¼¯

4. æ·»åŠ å³æ™‚çµ±è¨ˆ
   - Supabase Realtime
   - æ•¸å­—æ»¾å‹•å‹•ç•«

5. æ¸¬è©¦å®Œæ•´æµç¨‹
```
